CREATE DATABASE hindu_wheels; 

create table ticket_categories
(
    id            integer generated always as identity
        constraint ticket_categories_pk
            primary key,
    category_name varchar not null
);

alter table ticket_categories
    owner to postgres;

create table companies
(
    id          integer generated by default as identity
        constraint companies_pk
            primary key,
    name        varchar not null,
    email       varchar not null,
    phone       varchar,
    description varchar,
    domain      varchar, 
    active   boolean not null
);

alter table companies
    owner to postgres;

alter table companies
    alter column active set default true;
    
alter table companies
    add constraint companies_unique_email unique (email),
    add constraint companies_unique_phone unique (phone),
    add constraint companies_unique_domain unique (domain); 

create table products
(
    id                  integer generated by default as identity
        constraint products_pk
            primary key,
    product_name        varchar not null,
    product_description varchar,
    price               integer,
    product_category    varchar,
    company             integer not null
        constraint products_companies_id_fk
            references companies,
    active bool default true not null
);

alter table products
    owner to postgres;

alter table products
    add constraint products_unique_product_x_company   unique (product_name,company);



create table ticket_status
(
    id     integer generated by default as identity
        constraint ticket_status_pk
            primary key,
    status varchar not null
);

alter table ticket_status
    owner to postgres;

create table roles
(
    id   integer generated by default as identity
        constraint roles_pk
            primary key,
    role varchar not null
);

alter table roles
    owner to postgres;

create table users
(
    id       integer generated always as identity
        constraint users_pk
            primary key,
    name     varchar not null,
    email    varchar not null,
    password varchar not null,
    company integer 
        constraint users_company_fk 
        references companies, 
    role     integer
        constraint users_roles_id_fk
            references roles,
    active   boolean not null
);

alter table users
    alter column active set default true;

alter table public.users
    add constraint users_unique_email unique (email);


alter table users
    owner to postgres;


create table public.users_x_companies
(
    user_id integer
        constraint users_x_companies_users_id_fk
            references public.users,
    company integer
        constraint users_x_companies_companies_id_fk
            references public.companies,
    constraint users_x_companies_pk
        primary key (user_id, company)
);


create table tickets
(
    id              integer generated always as identity
        constraint tickets_pk
            primary key,
    message         varchar not null,
    status          integer not null
        constraint tickets_ticket_status_id_fk
            references ticket_status,
    customer        integer not null
        constraint tickets_users_id_fk
            references users,
    product_id      integer
        constraint tickets_products_id_fk
            references products,
    customer_agent  integer
        constraint tickets_users_id_fk_2
            references users,
    ticket_category integer not null
        constraint tickets_ticket_categories_id_fk
            references ticket_categories
);

alter table tickets
    owner to postgres;

create table customer_agentsxticket_category
(
    ticket_category integer not null
        constraint customer_agentsxticket_category_ticket_categories_id_fk
            references ticket_categories,
    customer_agent  integer not null
        constraint customer_agentsxticket_category_users_id_fk
            references users
);

alter table customer_agentsxticket_category
    owner to postgres;

